import &StandardImport, &PipelineWithRegistry

describe
  basics: ->
    test "declare fields" ->
      class MyPipeline extends Pipeline
        @fields
          name:   :string
          age:    :number

        @field
          address: :string

      assert.eq
        name: :string, age: :number, address: :string
        MyPipeline.getFields()

  normalize: ->
    test "normalizedFields fields" ->
      {myPipeline} = class MyPipeline extends Pipeline
        @fields
          name:   :string
          age:    :number

      assert.eq
        name:
          dataType:   :string
          fieldType:  :string
          validate:   :function

        age:
          dataType:   :number
          fieldType:  :number
          fromString: :function
          validate:   :function

        object v, k from myPipeline.normalizedFields
          assert.isPlainObject v
          object v2 from v
            if v2 is Function
              :function
            else v2
