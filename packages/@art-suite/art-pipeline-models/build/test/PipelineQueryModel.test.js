"use strict"
let Caf = require('caffeine-script-runtime');
Caf.defMod(module, () => {return Caf.importInvoke(["describe", "test", "assert", "newRegistries", "Pipeline", "merge", "PipelineQueryModel", "formattedInspect", "Object"], [global, require('./StandardImport')], (describe, test, assert, newRegistries, Pipeline, merge, PipelineQueryModel, formattedInspect, Object) => {return describe({noop: function() {return test("noop", () => assert.eq(1, 1));}, pre2020Style: function() {let pipelineRegistry, models, defineModelsForAllPipelines, Post; ({pipelineRegistry, modelRegistry: {models}, defineModelsForAllPipelines} = newRegistries()); Post = Caf.defClass(class Post extends Pipeline {}, function(Post, classSuper, instanceSuper) {this.registry(pipelineRegistry); this.query({postsByUserId: function(request) {return [{userId: request.key, message: "Hi!"}, {userId: request.key, message: "Really?"}];}}); this.publicRequestTypes("postsByUserId"); this.filter({after: {all: function(response) {return response.withData(Caf.array(response.data, (record) => merge(record, {message: `${Caf.toString(record.message)} :)`})));}}});}); defineModelsForAllPipelines(); test("query model defined", () => assert.instanceOf(models.postsByUserId, PipelineQueryModel, formattedInspect({definedModels: Object.keys(models), lookingForModel: "postsByUserId"}))); return test("query loadData goes through pipeline", () => models.postsByUserId.loadData("abc123").then((res) => assert.eq(res, [{userId: "abc123", message: "Hi! :)"}, {userId: "abc123", message: "Really? :)"}])));}, "2020Style": {basic: function() {let messagesByUserId, pipelineRegistry, modelRegistry, models, defineModelsForAllPipelines, Message; messagesByUserId = null; ({pipelineRegistry, modelRegistry, models, defineModelsForAllPipelines} = newRegistries()); Message = Caf.defClass(class Message extends Pipeline {}, function(Message, classSuper, instanceSuper) {this.registry(pipelineRegistry); this.query({byUserId: {query: function(request) {return [{userId: request.key, message: "Hi!"}, {userId: request.key, message: "Really?"}];}, keyFields: ["userId"]}}); this.publicRequestTypes("byUserId"); this.filter({after: {all: function(response) {return response.withData(Caf.array(response.data, (record) => merge(record, {message: `${Caf.toString(record.message)} :)`})));}}});}); ({messagesByUserId} = defineModelsForAllPipelines()); test("query model defined", () => assert.instanceOf(messagesByUserId, PipelineQueryModel)); test("query loadData goes through pipeline", () => messagesByUserId.loadData("abc123").then((res) => assert.eq(res, [{userId: "abc123", message: "Hi! :)"}, {userId: "abc123", message: "Really? :)"}]))); return test("queryModel.propsToKey", () => assert.eq("user1", messagesByUserId.propsToKey({user: {id: "user1"}})));}, codeReuse: function() {let pipelineRegistry, modelRegistry, models, defineModelsForAllPipelines, UserOwned, Email, Photo; ({pipelineRegistry, modelRegistry, models, defineModelsForAllPipelines} = newRegistries()); UserOwned = Caf.defClass(class UserOwned extends Pipeline {}, function(UserOwned, classSuper, instanceSuper) {this.registry(pipelineRegistry); this.query({byUserId: function(request) {return [{userId: request.key, message: "Hi!"}, {userId: request.key, message: "Really?"}];}}); this.publicRequestTypes("byUserId"); this.filter({after: {all: function(response) {return response.withData(Caf.array(response.data, (record) => merge(record, {message: `${Caf.toString(response.pipeline.name)}: ${Caf.toString(record.message)} :)`})));}}});}); Email = Caf.defClass(class Email extends UserOwned {}); Photo = Caf.defClass(class Photo extends UserOwned {}); defineModelsForAllPipelines(); test("query model defined", () => {assert.instanceOf(models.emailsByUserId, PipelineQueryModel); return assert.instanceOf(models.photosByUserId, PipelineQueryModel);}); return test("query loadData goes through pipeline", () => models.emailsByUserId.loadData("abc123").then((res) => assert.eq(res, [{userId: "abc123", message: "email: Hi! :)"}, {userId: "abc123", message: "email: Really? :)"}])));}}});});});
//# sourceMappingURL=PipelineQueryModel.test.js.map
