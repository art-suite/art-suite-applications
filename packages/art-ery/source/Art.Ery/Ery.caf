import &StandardImport, &@ArtSuite/ArtPipelines.PipelineRegistry, &Config

global.artEryPipelines = pipelineRegistry.pipelines
global.artEryPipelineRegistries = pipelineRegistries
[]
  &Filters
  &DatabaseFilters
  &Filters/PrefetchedRecordsCache
  {}
    &@ArtSuite/ArtPipelines.Filter
    &@ArtSuite/ArtPipelines.PipelineRegistry
    &@ArtSuite/ArtPipelines.RequestHandler
    &@ArtSuite/ArtPipelines.Request
    &Filters/PrefetchedRecordsCache
    &@ArtSuite/ArtPipelines.Session
    config
    pipelineRegistry
    pipelineRegistry.pipelines
    pipelineRegistry.session
    pipelineRegistries

    sendInitializeRequestToAllPipelines: (registry = pipelineRegistry)->
      Promise.all array pipeline in registry.pipelines when
          pipeline.class.getHandlers().initialize
        pipeline.initialize originatedOnServer: true

    initForTesting: ->
      &ArtEry
      Promise
      .then ->
        unless &ArtEry.config.remoteServer
          &ArtEry.sendInitializeRequestToAllPipelines()

    getArtEryRemoteServer: -> config.remoteServer
