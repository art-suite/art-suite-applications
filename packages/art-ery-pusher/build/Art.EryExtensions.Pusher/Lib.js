"use strict"
let Caf = require('caffeine-script-runtime');
Caf.defMod(module, () => {return Caf.importInvoke(["Config"], [global, require('./StandardImport'), {Config: require('./Config'), ArtEry: require('art-ery')}], (Config) => {let config, verboseLog, encodePusherChannelName, getPusherChannel; config = Config.config; verboseLog = Config.verboseLog; encodePusherChannelName = function(key) {return key.replace(/[^-a-zA-Z0-9_=@,;]/g, ";");}; return {verboseLog, getPusherChannel: getPusherChannel = function(modelName, key) {return encodePusherChannelName(Caf.each2([modelName, key], (item) => encodePusherChannelName(item)).join("."));}, subscribeToChanges: function(modelName, key, handler) {let pusherClient, channelName, eventName, channel; return (pusherClient = Config.pusherClient) ? (channelName = getPusherChannel(modelName, key), eventName = config.pusherEventName, verboseLog({subscribe: {channelName}}), channel = pusherClient.subscribe(channelName), channel.bind(eventName, handler), {unsubscribe: () => {verboseLog({unsubscribe: {channelName}}); channel.unbind(eventName, handler); return pusherClient.unsubscribe(channelName);}}) : undefined;}, sendChanged: function(modelName, key, payload) {let pusherEventName, channel; pusherEventName = config.pusherEventName; channel = getPusherChannel(modelName, key); verboseLog({sendChanged: {channel, pusherEventName, modelName, key, payload, pusherServer: Config.pusherServer}}); return (Config.pusherServer != null) ? (Config.pusherServer.trigger(channel, pusherEventName, payload || {}), true) : undefined;}};});});
//# sourceMappingURL=Lib.js.map
